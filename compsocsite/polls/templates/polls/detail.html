{% extends 'polls/base.html' %}

{% block extra_head %}


<!-- Google Analytics -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-81006265-1', 'none');
 //ga('create', 'UA-81006265-1', 'none','DetailTracker');
  ga('send', 'pageview');
 ga('send', 'event', 'Button', 'click', 'left-sortable');
 //ga('DetailTracker.send', 'pageview');
ga(function(tracker) {
  // Logs the tracker created above to the console.
  console.log(tracker);
});
    var left-form=document.getElementById('left-sortable');
    form.addEventListener('submit', function(event) {

  // Prevents the browser from submiting the form
  // and thus unloading the current page.
  event.preventDefault();

  // Sends the event to Google Analytics and
  // resubmits the form once the hit is done.
  ga('send', 'event', 'Left Form', 'submit', {
    hitCallback: function() {
      form.submit();
    }
  });
});

</script>
    
<!-- End Google Analytics -->

<!-- Google Tag Manager -->
<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-59SLDM"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-59SLDM');</script>
<!-- End Google Tag Manager -->



<script src="//code.jquery.com/jquery-1.10.2.js"></script>
<script src="//code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
<script src='/static/js/shared.js'></script>
{% if request.flavour == "mobile" %}
<script src='/static/js/mobile.js'></script>
{% else %}
<script src='/static/js/desktop.js'></script>
{% endif %}

<link rel="stylesheet" href="//code.jquery.com/ui/1.12.0/themes/base/jquery-ui.css">
<link rel="stylesheet" href="/resources/demos/style.css">
    <style>
.sortable1 {background:transparent;}
.aftersort {background-color:#eee;}
.hide1 {background-color:transparent; min-height=5px;min-width:15px;}
  </style>


  <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
  <script src="https://code.jquery.com/ui/1.12.0/jquery-ui.js"></script>
  <script>
      
      
      
      $(function() {
          
           $('.hide1')
                .mouseover(function(){
                 $('.ept',this).show();})
           ;
          
          
        var oldList, newList, item,sortin;
          
        $("ul.choice1").sortable({
           
            start: function(event, ui) {
                sortin=-1,
                item = ui.item;
                newList = oldList = ui.item.parent();
                
            },
            
            stop: function(event, ui) {
                if(oldList.attr('id')!=newList.attr('id')){
                    newList.addClass('aftersort'); 

                } 
                
                //no ul background when ul has only one li
                 if(oldList.attr('class').indexOf('aftersort')>-1 && oldList.children().size()==1){
                    oldList.removeClass('aftersort');    
                }
                
                //alert(oldList.attr('id')+" TO "+newList.attr('id'));
            },
               
            change: function(event, ui) {  
                if(ui.sender) newList = ui.placeholder.parent();
            },
            connectWith: "ul.choice1",
        }).disableSelection();
          
            
              
    });
    
  </script>


{% endblock %}

{% block content %}
{% if error_message %}
<p>
<strong>{{ error_message }}</strong>
</p>
{% endif %}

<p>
{% if messages %}
<ul class="messages">
    {% for message in messages %}
    <div {% if message.tags %} class="alert alert-{{ message.tags }}"{% endif %}>
        {{ message }}  <a href="{% url 'polls:regular_polls'%}">Return home</a>
    </div>
    {% endfor %}
</ul>
{% endif %}
</p>

{% if question.status == 2 %}
<div class="grid">
<div class="row">
{% if question.imageURL != Null and question.imageURL != '' %}
<div class="col-md-2" {% if request.flavour == "mobile" %} style="width:20%;display:inline" {% endif %}>
<a href="{{ question.imageURL }}"><img src="{{ question.imageURL }}" width="150" ></a>
</div>
{% elif question.image %}
<div class="col-md-2" {% if request.flavour == "mobile" %} style="width:20%;display:inline" {% endif %}>
<a href="/{{ question.image.url }}"><img src="/{{ question.image.url }}" width="150" ></a>
</div>
{% endif %}
<div class="col-md-4" {% if request.flavour == "mobile" %} style="width:70%;" {% endif %}>
<h3 {% if request.flavour == "mobile" %} style="width:70%;display:inline" {% endif %}>
{{ question.question_text }}:</h3>
            <small class="text-muted">Created by {{ question.question_owner }}</small>
{% if question.question_desc %}
<h3 {% if request.flavour == "mobile" %} style="width:70%" {% endif %}>
{{ question.question_desc }}
</h3>
{% endif %}
<!-- <p>
<b>Voters: </b>
{% for voter in question.question_voters.all %}
{% if voter == request.user %}
<i>{{ voter }}</i>,
{% else %}
{{ voter }},
{% endif %}
{% endfor %}
</p> -->
</div>
</div>
</div>

<form {% if request.session.anonymousvoter %} action="{% url 'polls:anonymousvote' question.id %}" {% else %} action="{% url 'polls:vote' question.id %}" {% endif %} method="post">
	<div class="row">


{% csrf_token %}
{% if request.flavour == "mobile" %}
<div class="col-md-6 margin-panel-top">
{% else %}
        <div class="col-md-6 margin-panel-top">
{% endif %}
<div class="panel panel-default">
<div class="panel-heading" >
<b>Your preferences:</b>
   {% if request.flavour == "mobile" %}
<button id="submitbutton" type="submit" onclick="submitPref();" class="submit-button-mobile" >
<span class="glyphicon glyphicon-upload" style="font-size:80%;color:white;">Submit</span>
</button>
<button id="submitbutton" type="submit" onclick="submitPref();" class="btn btn-success" style ="float: right; display: none;">
Submit
       </button>
   {% else %}
<a href="{% url 'polls:detail' question.id %}?order=null" class="btn btn-danger reset-button" style="background">Clear</a>
<button id="submitbutton" type="submit" onclick="submitPref();" class="btn btn-success submit-button">
               Submit
</button>
{% endif %}
   <input type="hidden" id="pref_order" name="pref_order" value=""/>
</div>
  
                
        <div class="panel-body" >

            <div id="left-sortable" >
            {% if currentSelection %}
            
            {% for selection in currentSelection %}
            {% for item in question.item_set.all %}

            {% if selection.0 == item %}
            
          
            <ul class="choice1 sortable1" id="item{{ forloop.counter }}">
             <li style="padding:10px;">  
            {% if selection.0.image %}
                    <img class="item" src='/{{ selection.0.image.url }}'/>
            {% endif %}
            {% if item.imageURL != Null %}
                    <img class="item" src='{{ item.imageURL }}'/>
            {% endif %}

            {{ selection.0 }}</li></ul>

            {% endif %}

            {% endfor %}
            {% endfor %}
            {% endif %}
            </div> <!-- left-sortable-->
        </div>
{% if request.flavour == "mobile" %}
<button onclick="javascript:window.location.href='{% url 'polls:detail' question.id %}?order=null'; return false;" class="reset-button-mobile">
       <a href="{% url 'polls:detail' question.id %}?order=null" class="glyphicon glyphicon-trash redcolor" style="color:white;">Clear</a>
   </button>
{% endif %}
</div>
</div>


{% if request.flavour == "mobile" %}
<div class="col-md-6 margin-panel-top">
{% else %}
<div class="col-md-6 margin-panel-top">
{% endif %}
<div class="panel panel-default">
<div class="panel-heading">
<b>Remaining Options:</b>
{% if request.flavour == "mobile" %}
<button onclick="moveAll(); return false;" class="move-all-button-mobile">
<span class="glyphicon glyphicon-arrow-up bluecolor" style="font-size:80%;float: center; color:white;">All</span>
       </button>
   {% else %}
       <button onclick="moveAll(); return false;" class="btn btn-primary move-all-button" >
      Move All
       </button>
{% endif %}
</div>
<div class="panel-body">
<ul id="right-sortable" class="list-group">
{% if currentSelection == None %}
{% for item in items %}
<li class="list-group-item" onclick = "moveToPref(this)" id="item{{ item.item_text }}">
{% if item.image %}
<img class="item" src='/{{ item.image.url }}'/>
{% endif %}
                   {% if item.imageURL != Null %}
                   	<img class="item" src='{{ item.imageURL }}'/>
                   {% endif %}
{{ item.item_text }}
</li>
{% endfor %}
{% endif %}
                  

					</ul>
				</div>
			</div>
		</div>
	
	</div>
	<div>
		<textarea class="form-control" name="comment" rows="4" cols="50" maxlength="1000" placeholder="Enter your comments here...">{% if request.user.username != ""%}{{lastcomment}}{% endif %}</textarea>
	</div>

</form>


<script>
var wholeHeight1 = $('#left-sortable')[0].scrollHeight;
var wholeHeight2 = $('#right-sortable')[0].scrollHeight;
if (wholeHeight1 > wholeHeight2) {
$('#right-sortable').css("height", wholeHeight1);
} else {
$('#left-sortable').css("height", wholeHeight2);
}
$('#left-sortable').sortable('refresh');
$('#right-sortable').sortable('refresh');
    


</script>

{% elif question.status == 1%}

<p>This poll has not started yet.</p>

{% else %}

<p>	This poll has ended.</p>

{% endif %}

{% endblock %}